| Copyright 2010 Castle Technology Ltd
|
| Licensed under the Apache License, Version 2.0 (the "License");
| you may not use this file except in compliance with the License.
| You may obtain a copy of the License at
|
|     http://www.apache.org/licenses/LICENSE-2.0
|
| Unless required by applicable law or agreed to in writing, software
| distributed under the License is distributed on an "AS IS" BASIS,
| WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
| See the License for the specific language governing permissions and
| limitations under the License.
|
| If there is no ROM image (e.g. the build failed), exit here
IfThere <Build$Dir>.Images.<Build$ImageName> Then Else Obey

| Run our clean script
Run <ab_res$dir>.clean

| Create an empty directory to hold the files that will be zipped up
CDir <ab_res$dir>.zip

| Copy the Castle licence file into the zip directory
Copy ab_res:Licence_v1/pdf <ab_res$dir>.zip.Licence_v1/pdf ~cf~r~v

| Copy the ReadMe for this build into the zip directory
Copy ab_res:ReadMe/txt <ab_res$dir>.zip.ReadMe/txt ~cf~r~v

| Copy the ROM image into the zip directory
Copy <Build$Dir>.Images.<Build$ImageName> <ab_res$dir>.zip.riscos ~cf~r~v

| Copy !SDCreate into the zip directory
CDir <ab_res$dir>.zip.!SDCreate
CDir <ab_res$dir>.zip.!SDCreate.scripts
CDir <ab_res$dir>.zip.!SDCreate.scripts.source
Copy ab_res:!SDCreate.!Boot                   <ab_res$dir>.zip.!SDCreate.!Boot                   ~cf~r~v
Copy ab_res:!SDCreate.!Help                   <ab_res$dir>.zip.!SDCreate.!Help                   ~cf~r~v
Copy ab_res:!SDCreate.!Run                    <ab_res$dir>.zip.!SDCreate.!Run                    ~cf~r~v
Copy ab_res:!SDCreate.!Sprites                <ab_res$dir>.zip.!SDCreate.!Sprites                ~cf~r~v
Copy ab_res:!SDCreate.!Sprites22              <ab_res$dir>.zip.!SDCreate.!Sprites22              ~cf~r~v
Copy ab_res:!SDCreate.blank                   <ab_res$dir>.zip.!SDCreate.blank                   ~cf~r~v
Copy ab_res:!SDCreate.Desc                    <ab_res$dir>.zip.!SDCreate.Desc                    ~cf~r~v
Copy ab_res:!SDCreate.Messages                <ab_res$dir>.zip.!SDCreate.Messages                ~cf~r~v
Copy ab_res:!SDCreate.SDCreate                <ab_res$dir>.zip.!SDCreate.SDCreate                ~cf~r~v
Copy ab_res:!SDCreate.Templates               <ab_res$dir>.zip.!SDCreate.Templates               ~cf~r~v
Copy ab_res:!SDCreate.scripts.BeagleBoard/scr <ab_res$dir>.zip.!SDCreate.scripts.BeagleBoard/scr ~cf~r~v
Copy ab_res:!SDCreate.scripts.DevKit8000/scr  <ab_res$dir>.zip.!SDCreate.scripts.DevKit8000/scr  ~cf~r~v
Copy ab_res:!SDCreate.scripts.IGEPv2/ini      <ab_res$dir>.zip.!SDCreate.scripts.IGEPv2/ini      ~cf~r~v
Copy ab_res:!SDCreate.scripts.Pandora/scr     <ab_res$dir>.zip.!SDCreate.scripts.Pandora/scr     ~cf~r~v
Copy ab_res:!SDCreate.scripts.source.beagle   <ab_res$dir>.zip.!SDCreate.scripts.source.beagle   ~cf~r~v
Copy ab_res:!SDCreate.scripts.source.convert  <ab_res$dir>.zip.!SDCreate.scripts.source.convert  ~cf~r~v
Copy ab_res:!SDCreate.scripts.source.devkit   <ab_res$dir>.zip.!SDCreate.scripts.source.devkit   ~cf~r~v
Copy ab_res:!SDCreate.scripts.source.igep     <ab_res$dir>.zip.!SDCreate.scripts.source.igep     ~cf~r~v
Copy ab_res:!SDCreate.scripts.source.pandora  <ab_res$dir>.zip.!SDCreate.scripts.source.pandora  ~cf~r~v

| Copy the InstallHD4 script into the zip directory
Copy ab_res:InstallHD4 <ab_res$dir>.zip.InstallHD4 ~cf~r~v

| Set the zip directory as the current directory
Dir <ab_res$dir>.zip

| Create a zip archive with the required files in it
Do zip -9qr ^.<ab_local$zip> *

| Return the CSD to its original state
Back

| Delete any pre-existing zip archive on the autobuild server
Remove <ab_zip$file>

| Copy the template zip archive onto the autobuild server
SetType <ab_res$dir>.<ab_local$zip> &A91
Copy <ab_res$dir>.<ab_local$zip> <ab_zip$file> ~cfr~v
Access <ab_zip$file> rw/r