/* Copyright 1996 Acorn Computers Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*> c.wcompare <*/
/*---------------------------------------------------------------------------*/
/* wild card object comparison                    Copyright (c) 1988 JGSmith */
/*---------------------------------------------------------------------------*/

#include <stdio.h>
#include <ctype.h>

#include "ASCII.h"
#include "wcompare.h"

#include "debuglib/debuglib.h"

/*---------------------------------------------------------------------------*/

#define makelower(c) (((c < 'A') || (c > 'Z')) ? (c) : tolower(c))

/*---------------------------------------------------------------------------*
 * compare two objects
 *
 * in:  fptr -> full object name (NULL terminated)
 *      gptr -> wildcarded object name (NULL terminated)
 * out: boolean flag - TRUE (matched) - FALSE (failed match)
 */
int wild_card_compare(char *fptr, char *gptr, char wcmult, char wcsing)
{

// dprintf(("","WCC: fptr = \"%s\", gptr = \"%s\"\n",fptr,gptr));

 if (*fptr == '\0')
  {
   /* end of full name */
   if (*gptr == wcmult) /* if multiple wildcard character then continue */
   {
    return(wild_card_compare(fptr,&gptr[1],wcmult,wcsing)) ;
   }
   else
   {
    return(*gptr == '\0') ; /* matched if end of wildcarded name */
   }
  }

 if (*gptr == '\0')
 {
  return(FALSE) ; /* end of wildcarded name reached before full name */
 }
 /* check if this character matches */
// if ((makelower(*fptr) == makelower(*gptr)) || (*gptr == wcsing))
// if ( ((*fptr) == (*gptr)) || (*gptr == wcsing))
 if ( (toupper(*fptr) == toupper(*gptr)) || (*gptr == wcsing))
 {
  return(wild_card_compare(&fptr[1],&gptr[1],wcmult,wcsing)) ; /* yes - then continue */
 }

 if (*gptr == wcmult) /* if multiple wildcard character, check both paths */
 {
  return(wild_card_compare(fptr,&gptr[1],wcmult,wcsing)||wild_card_compare(&fptr[1],gptr,wcmult,wcsing)) ;
 }
 else
 {
  return(FALSE) ; /* characters do not match */
 }
}

/*-------------------------------------------------------------------------*/
/* Check if the given text string contains wildcard characters */

int checknotwildcarded(char *name, char wcmult, char wcsing)
{
 for (; (*name); name++)
  if ((*name == wcmult) || (*name == wcsing))
   return(-1) ; /* wildcard character has been found */

 return(0) ; /* OK : does not contain wildcard characters */
}

/*-------------------------------------------------------------------------*/
/*> EOF c.wcompare <*/
